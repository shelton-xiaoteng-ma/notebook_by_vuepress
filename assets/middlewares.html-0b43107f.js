import{_ as e,Y as a,Z as l,a4 as s}from"./framework-957baa9a.js";const i={},n=s(`<h1 id="中间件-middleware" tabindex="-1"><a class="header-anchor" href="#中间件-middleware" aria-hidden="true">#</a> 中间件 MiddleWare</h1><h2 id="_1-httperrormiddleware-处理200-300之外的返回码" tabindex="-1"><a class="header-anchor" href="#_1-httperrormiddleware-处理200-300之外的返回码" aria-hidden="true">#</a> 1. HttpErrorMiddleware 处理200-300之外的返回码</h2><p>https://juejin.im/post/5c10a1caf265da61380f1315 源码展示</p><ol><li>默认情况 <ol><li>200-300 调用callback，除此之外ignore</li></ol></li><li>指定要处理 <ol><li>request.meta可以指定<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>    request.meta[&#39;handle_httpstatus_all&#39;] = Ture
    # 或者
    request.meta[&#39;handle_httpstatus_list&#39;] = [301, 302...]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>spiders里设置<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>    self.handle_httpstatus_list = [301, 302...]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>在setting中配置</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>    HTPERROR_ALLOWED_CODES <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">403</span><span class="token punctuation">]</span>  <span class="token comment"># 默认为[]</span>
    <span class="token comment"># 或</span>
    HTTPERROR_ALLOW_ALL <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 默认为False</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>处理方式 <ol><li>callback中能够处理 <ul><li>200-300</li><li>上述填写的其他<code>handle-http-error</code></li><li>如果使用了<code>HTTPERROR_ALLOW_ALL = True</code>, 所有的请求都在callback中处理，同时<code>handle-http-error</code>配置将被覆盖，因为本身包含了所有请求</li></ul></li><li>errback处理 <ul><li>上述之外的，因为有异常抛出</li></ul></li><li>好习惯 <ol><li>除非明确知道要处理的请求，否则我会将所有都在callback中处理，打log或者加入redis重试，因为可以记录错误码</li></ol></li></ol></li></ol>`,4),t=[n];function d(r,c){return a(),l("div",null,t)}const p=e(i,[["render",d],["__file","middlewares.html.vue"]]);export{p as default};
