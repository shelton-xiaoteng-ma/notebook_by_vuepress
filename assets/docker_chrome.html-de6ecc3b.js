import{_ as n,Y as s,Z as a,a4 as e}from"./framework-957baa9a.js";const t={},o=e(`<h1 id="docker-chrome" tabindex="-1"><a class="header-anchor" href="#docker-chrome" aria-hidden="true">#</a> Docker Chrome</h1><blockquote><p>Docker内运行chrome</p></blockquote><p><a href=""></a></p><ul><li>selenium/standalone-chrome:latest</li><li>browserless/chrome:latest</li></ul><h2 id="selenium-standalone-chrome-latest" tabindex="-1"><a class="header-anchor" href="#selenium-standalone-chrome-latest" aria-hidden="true">#</a> selenium/standalone-chrome:latest</h2><ol><li><p>安装</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 安装</span>
<span class="token function">sudo</span> <span class="token function">docker</span> pull selenium/standalone-chrome
<span class="token comment"># docker run --rm  -p 3000:3000  -e &quot;MAX_CONCURRENT_SESSIONS=10&quot; browserless/chrome:latest</span>
<span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">4444</span>:4444 <span class="token parameter variable">-p</span> <span class="token number">7900</span>:7900 --shm-size<span class="token operator">=</span><span class="token string">&quot;2g&quot;</span> <span class="token parameter variable">--name</span> nice_chrome selenium/standalone-chrome:latest
<span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">4444</span>:4444 <span class="token parameter variable">-p</span> <span class="token number">7901</span>:7900 --shm-size<span class="token operator">=</span><span class="token string">&quot;2g&quot;</span> <span class="token parameter variable">--name</span> nice_chrome1 selenium/standalone-chrome:113.0-20230508
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>测试</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>desired_capabilities <span class="token keyword">import</span> DesiredCapabilities
<span class="token keyword">import</span> time
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Remote<span class="token punctuation">(</span>
    <span class="token comment"># command_executor=&quot;http://chrome:4444/wd/hub&quot;,</span>
    command_executor<span class="token operator">=</span><span class="token string">&quot;http://172.31.36.228:4444/wd/hub&quot;</span><span class="token punctuation">,</span>
    desired_capabilities<span class="token operator">=</span>DesiredCapabilities<span class="token punctuation">.</span>CHROME
<span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;http://www.baidu.com&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 5900</span>
http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">172.31</span><span class="token number">.36</span><span class="token number">.228</span><span class="token punctuation">:</span><span class="token number">7900</span><span class="token operator">/</span>?autoconnect<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>resize<span class="token operator">=</span>scale<span class="token operator">&amp;</span>password<span class="token operator">=</span>secret

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>demo</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h2 id="nginx-设置代理-实现访问eks内部服务" tabindex="-1"><a class="header-anchor" href="#nginx-设置代理-实现访问eks内部服务" aria-hidden="true">#</a> nginx 设置代理, 实现访问eks内部服务</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 访问 https://chrome.bigonelab.tech/chrome1/wd/hub</span>
<span class="token comment"># 实际访问 https://chrome1:4444/wd/hub</span>
server <span class="token punctuation">{</span>
    location ^/<span class="token punctuation">(</span>chrome<span class="token punctuation">\\</span>d*<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">echo</span> <span class="token variable">$1</span><span class="token punctuation">;</span>
        <span class="token comment"># proxy_pass /chrome1:4444/wd/hub;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

    <span class="token comment">#把 /bbb 注释</span>
    restart error nginx: <span class="token punctuation">[</span>emerg<span class="token punctuation">]</span> unknown <span class="token string">&quot;zoo&quot;</span> variable

    <span class="token comment">#把 /bbb 解开注释</span>
    <span class="token comment">#curl 120.27.105.225/bbb——&gt; Hello Wold;</span>
    <span class="token comment">#curl 120.27.105.225/aaa——&gt;;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker run -d -p 80:80 --name nginx --privileged=true -v /mydata/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /mydata/nginx/html:/etc/nginx/html -v /mydata/nginx/log:/var/log/nginx nginx</p><p>sudo docker run --name nginx-test -p 8080:80 -v /home/xiaoteng/nginx/nginx.conf:/etc/nginx/nginx.conf -d nginx</p><p>sudo docker restart eaa15ff659b0</p><p>sudo docker logs eaa15ff659b0</p><p>server { location ~ /chrome(\\d+) { # default_type text/plain; # return 200 /$1$2:$2; # proxy_pass http://$1$2:$2; # proxy_pass http://chrome-$1-headless.svc.prod:4444; } # 严格匹配/chrome location = /chrome { default_type text/plain; return 502 &quot;chrome&quot;; # proxy_pass /chrome1:4444/wd/hub; } }</p><p>import datetime from retrying import retry # 需第三方库，需pip进行安装 from selenium import webdriver from selenium.webdriver.chrome.options import Options from selenium.webdriver.common.by import By</p><p>@retry(wait_fixed=10, stop_max_attempt_number=1) def click(path): driver.find_element(By.XPATH, path).click()</p><p>chrome_options = Options() chrome_options.page_load_strategy = &#39;none&#39; driver = webdriver.Chrome(options=chrome_options) start_time = datetime.datetime.now() driver.get(&#39;https://www.iqiyi.com/&#39;) click(&#39;//*[@id=&quot;block-C&quot;]/div/div/div/div[1]/div[1]/div/div[1]/div/div/a/span[2]&#39;) end_time = datetime.datetime.now() print(end_time - start_time)</p>`,16),i=[o];function p(c,r){return s(),a("div",null,i)}const d=n(t,[["render",p],["__file","docker_chrome.html.vue"]]);export{d as default};
