import{_ as n,Y as s,Z as a,a4 as p}from"./framework-957baa9a.js";const t={},e=p(`<h1 id="postgresql" tabindex="-1"><a class="header-anchor" href="#postgresql" aria-hidden="true">#</a> Postgresql</h1><p>[TOC]</p><h2 id="_1-相关" tabindex="-1"><a class="header-anchor" href="#_1-相关" aria-hidden="true">#</a> 1. 相关</h2><ol><li>greenplum</li><li>redshift</li></ol><h2 id="_2-常用语法" tabindex="-1"><a class="header-anchor" href="#_2-常用语法" aria-hidden="true">#</a> 2. 常用语法</h2><ol><li>建表 <ol><li><p>去重和类型转换</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> dw_app_sku
<span class="token keyword">select</span> <span class="token keyword">distinct</span> <span class="token keyword">on</span> <span class="token punctuation">(</span>sku_id<span class="token punctuation">)</span>
sku_id<span class="token punctuation">,</span>seller_id<span class="token punctuation">,</span>buyer_id<span class="token punctuation">,</span><span class="token keyword">status</span><span class="token punctuation">,</span>price::float8<span class="token punctuation">,</span>  <span class="token comment">-- 类型转换</span>
substring<span class="token punctuation">(</span>updated<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">as</span> updated<span class="token punctuation">,</span>substring<span class="token punctuation">(</span>created<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">as</span> created <span class="token punctuation">,</span>batch_id
<span class="token keyword">from</span> ods_mercari_app_sku
<span class="token keyword">order</span> <span class="token keyword">by</span> sku_id<span class="token punctuation">,</span> batch_id <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>权限分配</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">grant</span> <span class="token keyword">usage</span> <span class="token keyword">on</span> <span class="token keyword">schema</span> aspex_mercari <span class="token keyword">to</span> data_loader<span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">on</span> aspex_mercari<span class="token punctuation">.</span>ods_mercari_app_sku <span class="token keyword">to</span> data_loader<span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">select</span><span class="token punctuation">,</span> <span class="token keyword">insert</span> <span class="token keyword">on</span> aspex_mercari<span class="token punctuation">.</span>ods_mercari_app_user <span class="token keyword">to</span> data_loader<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建语句</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">public</span><span class="token punctuation">.</span>final_buyer_txn <span class="token punctuation">(</span>
id serial8 <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span> <span class="token comment">-- 自增id</span>
user_id <span class="token keyword">text</span><span class="token punctuation">,</span>
create_date <span class="token keyword">text</span><span class="token punctuation">,</span>
create_month <span class="token keyword">text</span><span class="token punctuation">,</span>
create_quarter <span class="token keyword">text</span><span class="token punctuation">,</span>
yearmonth <span class="token keyword">text</span><span class="token punctuation">,</span>
sku int8<span class="token punctuation">,</span>    <span class="token comment">-- price float8,</span>
<span class="token keyword">value</span> int8<span class="token punctuation">,</span>
update_date <span class="token keyword">text</span>
<span class="token punctuation">)</span><span class="token keyword">WITH</span> <span class="token punctuation">(</span>APPENDONLY<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> ORIENTATION<span class="token operator">=</span><span class="token keyword">column</span><span class="token punctuation">,</span> compresstype<span class="token operator">=</span>ZLIB<span class="token punctuation">)</span>
<span class="token keyword">DISTRIBUTED</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>分区表</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> aspex_mercari<span class="token punctuation">.</span>ods_mercari_app_sku
<span class="token punctuation">(</span>
sku_id <span class="token keyword">text</span>
<span class="token punctuation">,</span> seller_id <span class="token keyword">text</span>
<span class="token punctuation">,</span> buyer_id <span class="token keyword">text</span>
<span class="token punctuation">,</span> <span class="token keyword">status</span> <span class="token keyword">text</span>
<span class="token punctuation">,</span> price <span class="token keyword">text</span>
<span class="token punctuation">,</span> updated <span class="token keyword">text</span>
<span class="token punctuation">,</span> created <span class="token keyword">text</span>
<span class="token punctuation">,</span> batch_id <span class="token keyword">date</span>
<span class="token punctuation">)</span>
<span class="token keyword">WITH</span> <span class="token punctuation">(</span>APPENDONLY<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> ORIENTATION<span class="token operator">=</span><span class="token keyword">column</span><span class="token punctuation">,</span> compresstype<span class="token operator">=</span>ZLIB<span class="token punctuation">)</span>
<span class="token keyword">DISTRIBUTED</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>seller_id<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> RANGE <span class="token punctuation">(</span>batch_id<span class="token punctuation">)</span>
<span class="token punctuation">(</span> <span class="token keyword">START</span> <span class="token punctuation">(</span><span class="token keyword">date</span> <span class="token string">&#39;2019-01-01&#39;</span><span class="token punctuation">)</span> INCLUSIVE
<span class="token keyword">END</span> <span class="token punctuation">(</span><span class="token keyword">date</span> <span class="token string">&#39;2021-01-01&#39;</span><span class="token punctuation">)</span> EXCLUSIVE
EVERY <span class="token punctuation">(</span><span class="token keyword">INTERVAL</span> <span class="token string">&#39;1 day&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>计算</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> 
seller_id<span class="token punctuation">,</span>ff<span class="token punctuation">.</span>create_date::<span class="token keyword">text</span><span class="token punctuation">,</span> ff<span class="token punctuation">.</span>create_month<span class="token punctuation">,</span> ff<span class="token punctuation">.</span>create_quarter<span class="token punctuation">,</span>
<span class="token string">&#39;2019-11-01&#39;</span><span class="token punctuation">,</span>
<span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>filter<span class="token punctuation">(</span><span class="token keyword">where</span> substring<span class="token punctuation">(</span>tt0<span class="token punctuation">.</span>created<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;2019-11&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sku_new<span class="token punctuation">,</span>
<span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>filter<span class="token punctuation">(</span><span class="token keyword">where</span> substring<span class="token punctuation">(</span>tt0<span class="token punctuation">.</span>created<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">&lt;&gt;</span> <span class="token string">&#39;2019-11&#39;</span> <span class="token operator">and</span> substring<span class="token punctuation">(</span>tt0<span class="token punctuation">.</span>updated<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;2019-11&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sku_update<span class="token punctuation">,</span> 
<span class="token function">sum</span><span class="token punctuation">(</span>price::<span class="token keyword">int</span><span class="token punctuation">)</span>filter<span class="token punctuation">(</span><span class="token keyword">where</span> substring<span class="token punctuation">(</span>tt0<span class="token punctuation">.</span>created<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;2019-11&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> value_new<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span>price::<span class="token keyword">int</span><span class="token punctuation">)</span>filter<span class="token punctuation">(</span><span class="token keyword">where</span> substring<span class="token punctuation">(</span>tt0<span class="token punctuation">.</span>created<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">&lt;&gt;</span> <span class="token string">&#39;2019-11&#39;</span> <span class="token operator">and</span> substring<span class="token punctuation">(</span>tt0<span class="token punctuation">.</span>updated<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;2019-11&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> value_update<span class="token punctuation">,</span>
num_sell_items<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&#39;2019-11-19&#39;</span>
<span class="token keyword">from</span> aspex_mercari<span class="token punctuation">.</span>ods_mercari_app_sku tt0
<span class="token keyword">left</span> <span class="token keyword">join</span> aspex_mercari<span class="token punctuation">.</span>ods_mercari_app_user tt1
<span class="token keyword">on</span> tt0<span class="token punctuation">.</span>seller_id <span class="token operator">=</span> tt1<span class="token punctuation">.</span>user_id
<span class="token keyword">left</span> <span class="token keyword">join</span> aspex_mercari<span class="token punctuation">.</span>app_user_info ff
<span class="token keyword">on</span> tt0<span class="token punctuation">.</span>seller_id<span class="token operator">=</span>ff<span class="token punctuation">.</span>user_id 
<span class="token keyword">where</span> tt1<span class="token punctuation">.</span>batch_id<span class="token operator">=</span><span class="token string">&#39;2019-11-01&#39;</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> seller_id<span class="token punctuation">,</span> num_sell_items <span class="token punctuation">,</span> ff<span class="token punctuation">.</span>create_date<span class="token punctuation">,</span> ff<span class="token punctuation">.</span>create_month<span class="token punctuation">,</span> ff<span class="token punctuation">.</span>create_quarter<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>类型判断</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">set</span> num_sell_items <span class="token operator">=</span> decode<span class="token punctuation">(</span>aaa<span class="token punctuation">.</span>now_sell_items<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> aaa<span class="token punctuation">.</span>now_sell_items<span class="token punctuation">)</span>::<span class="token keyword">int</span> <span class="token operator">-</span> decode<span class="token punctuation">(</span>bbb<span class="token punctuation">.</span>now_sell_items<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span> bbb<span class="token punctuation">.</span>now_sell_items<span class="token punctuation">)</span>::<span class="token keyword">int</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li></ol><h2 id="_3-权限管理" tabindex="-1"><a class="header-anchor" href="#_3-权限管理" aria-hidden="true">#</a> 3. 权限管理</h2><p>information_schema.table_privileges表记录着所有用户的权限信息。</p><ol><li><p>查看权限</p></li><li><p>修改权限</p></li></ol>`,9),o=[e];function c(l,i){return s(),a("div",null,o)}const k=n(t,[["render",c],["__file","index.html.vue"]]);export{k as default};
