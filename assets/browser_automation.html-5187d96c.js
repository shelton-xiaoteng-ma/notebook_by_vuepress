import{_ as t,Y as r,Z as i,a0 as e,a1 as n,a2 as a,a4 as o,E as c}from"./framework-957baa9a.js";const l={},p=e("h1",{id:"browser-automation",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#browser-automation","aria-hidden":"true"},"#"),n(" browser automation")],-1),d=e("h2",{id:"pyppeteer",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#pyppeteer","aria-hidden":"true"},"#"),n(" pyppeteer")],-1),u=o(`<li><p>环境配置, 安装chromium</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 下载链接被墙, 直接复制/data下的文件 chromium_588429.zip</span>
<span class="token comment"># 解压目录: /home/{{user}}/.local/share/pyppeteer/local-chromium/588429/,  {{user替换成个人用户名}}</span>
<span class="token function">unzip</span> chromium_588429.zip <span class="token parameter variable">-d</span> /home/<span class="token punctuation">{</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span><span class="token punctuation">}</span>/.local/share/pyppeteer/local-chromium/588429/

<span class="token comment"># 检查是否正确安装</span>
<span class="token function">import</span> pyppeteer
pyppeteer.executablePath<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 输出路径 &#39;/home/{{user}}/.local/share/pyppeteer/local-chromium/588429/chrome-linux/chrome&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>`,1),m=e("p",null,"配置",-1),h={href:"https://webscraping.pro/headless-chrome-detection-and-anti-detection",target:"_blank",rel:"noopener noreferrer"},v={href:"https://antoinevastel.com/bots/",target:"_blank",rel:"noopener noreferrer"},b={href:"https://blog.csdn.net/qq_39377418/article/details/106984835",target:"_blank",rel:"noopener noreferrer"},k=e("h2",{id:"undetected-chromedriver",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#undetected-chromedriver","aria-hidden":"true"},"#"),n(" undetected chromedriver")],-1),_=o(`<li><p>环境配置, 自定义环境, 尽量避免使用默认的浏览器, 可能影响其他项目使用, 比如selenium, pyppeteer</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 下载指定版本的chromedriver</span>
<span class="token function">wget</span> https://chromedriver.storage.googleapis.com/112.0.5615.49/chromedriver_linux64.zip
<span class="token function">unzip</span> chromedriver_linux64.zip
<span class="token comment"># chromedriver无需指定目录, 默认使用</span>
~/.local/share/undetected_chromedriver/chromedriver

<span class="token comment"># 下载浏览器</span>
<span class="token function">wget</span> https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
<span class="token comment"># dpkg -i google-chrome-stable_current_amd64.deb 将会安装在/usr/bin/google-chromes</span>
<span class="token comment"># 解压在自定义目录</span>
dpkg <span class="token parameter variable">-x</span> google-chrome-stable_current_amd64.deb ~/.local/share/undetected_chromedriver/

<span class="token comment"># chrome path</span>
~/.local/share/undetected_chromedriver/opt/google/chrome/google-chrome

<span class="token comment"># 检查版本</span>
~/.local/share/undetected_chromedriver/opt/google/chrome/google-chrome <span class="token parameter variable">--version</span>
~/.local/share/undetected_chromedriver/chromedriver <span class="token parameter variable">--version</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>代码示例</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> undetected_chromedriver <span class="token keyword">as</span> uc
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--no-sandbox&#39;</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--proxy-server={}&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>get_jp_intranet_proxies<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--ignore-ssl-errors=true&#39;</span><span class="token punctuation">)</span>
browser_path<span class="token operator">=</span><span class="token string">&#39;~/.local/share/undetected_chromedriver/opt/google/chrome/google-chrome&#39;</span>
driver <span class="token operator">=</span> uc<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>options<span class="token punctuation">,</span> browser_executable_path<span class="token operator">=</span>browser_path<span class="token punctuation">,</span> headless<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>`,2),g=e("p",null,"异常处理",-1),f=o(`<li><p>异常现象<code>[Errno 2] No such file or directory: &#39;~/.local/share/undetected_chromedriver/undetected/chromedriver&#39; -&gt; &#39;~/.local/share/undetected_chromedriver/undetected_chromedriver&#39;</code></p></li><li><p>原因: <code>uc.Chrome()</code>操作每次会从<code>https://chromedriver.storage.googleapis.com/112.0.5615.49/chromedriver_linux64.zip</code>下载最新版的chromedriver, <code>driver.quit()</code>又会执行删除操作, 详见<code>undetected_chromedriver/patcher.py __del__</code>, 如果使用多进程, 可能会有冲突</p></li><li><p>解决办法, 指定<code>driver_executable_path</code>阻止下载文件, 只在必要时手动更新版本</p><ul><li><p>下载匹配浏览器的<code>chromedriver</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 为方便管理避免冲突, 文件在~/.local/share/undetected_chromedriver</span>
<span class="token builtin class-name">cd</span> ~/.local/share/undetected_chromedriver
<span class="token function">wget</span> https://chromedriver.storage.googleapis.com/112.0.5615.49/chromedriver_linux64.zip
<span class="token function">unzip</span> chromedriver_linux64.zip
<span class="token comment"># 指定版本, 为了后续不同版本共存</span>
<span class="token function">cp</span> chromedriver chromedriver_112
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>代码中使用</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>browser_path<span class="token operator">=</span><span class="token string">&#39;~/.local/share/undetected_chromedriver/opt/google/chrome/google-chrome&#39;</span>
driver_path<span class="token operator">=</span><span class="token string">&#39;~/.local/share/undetected_chromedriver/chromedriver_112&#39;</span>
driver <span class="token operator">=</span> uc<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>options<span class="token punctuation">,</span> driver_executable_path<span class="token operator">=</span>driver_path<span class="token punctuation">,</span> browser_executable_path<span class="token operator">=</span>browser_path<span class="token punctuation">,</span> headless<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> version_main<span class="token operator">=</span><span class="token number">112</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li>`,3),x={href:"https://github.com/ultrafunkamsterdam/undetected-chromedriver/discussions/1063",target:"_blank",rel:"noopener noreferrer"},w={href:"https://www.zenrows.com/blog/undetected-chromedriver#what-is",target:"_blank",rel:"noopener noreferrer"},y=e("ul",null,[e("li",null,[n("简单来说就是通过修改chrome driver来达到防止检测, "),e("code",null,"undetected_chromedriver/patcher.py"),n(", "),e("code",null,"self.patch_exe()"),n("用于修改")])],-1);function z(C,q){const s=c("ExternalLinkIcon");return r(),i("div",null,[p,d,e("ol",null,[u,e("li",null,[m,e("ol",null,[e("li",null,[n("headless检测: "),e("a",h,[n("https://webscraping.pro/headless-chrome-detection-and-anti-detection"),a(s)])]),e("li",null,[e("a",v,[n("https://antoinevastel.com/bots/"),a(s)])]),e("li",null,[n("修改源安装chromium"),e("a",b,[n("https://blog.csdn.net/qq_39377418/article/details/106984835"),a(s)])])])])]),k,e("ol",null,[_,e("li",null,[g,e("ol",null,[e("li",null,[n("chromedriver引起的 "),e("ul",null,[f,e("li",null,[e("p",null,[e("a",x,[n("discussions: Multi-threaded use of UC is impossible"),a(s)])])])])])])]),e("li",null,[e("p",null,[e("a",w,[n("What Is Undetected ChromeDriver?"),a(s)])]),y])])])}const N=t(l,[["render",z],["__file","browser_automation.html.vue"]]);export{N as default};
