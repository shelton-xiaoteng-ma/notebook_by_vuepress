import{_ as p,Y as o,Z as l,a0 as n,a1 as s,a2 as t,a4 as a,E as c}from"./framework-957baa9a.js";const i={},u=a('<h1 id="wagtail-blog" tabindex="-1"><a class="header-anchor" href="#wagtail-blog" aria-hidden="true">#</a> wagtail blog</h1><h2 id="models" tabindex="-1"><a class="header-anchor" href="#models" aria-hidden="true">#</a> models</h2><p>wagtail 所有的page都是<code>Django models</code>, 可以使用Django提供的所有类型. wagtail 提供了<code>wagtail.fields.RichTextField</code>用来编辑富文本内容.</p><h3 id="database-fields" tabindex="-1"><a class="header-anchor" href="#database-fields" aria-hidden="true">#</a> Database fields</h3><p>每个<code>Wagtail page</code>都是一个<code>Django model</code>, 在数据库中表示一个单独的表.</p><p>每个<code>page type</code>都是一些自己的字段, 比如新闻包括发布时间和内容, 而活动页面包括场地和开始结束时间.</p><p>在wagtail中可以使用Django所有的fields, 第三方提供的也可以, django-taggit推荐, 自身提供两个:</p><ul><li>RichTextField - For rich text content</li><li>StreamField - A block-based content field (see: Freeform page content using StreamField)</li></ul><h3 id="search" tabindex="-1"><a class="header-anchor" href="#search" aria-hidden="true">#</a> Search</h3><p><code>search_fields</code> 定义了哪些字段会被增加到搜索中, 以及如何建立索引的, 包含两个列表: <code>SearchField</code>, <code>FilterField</code>, 分别用于富文本搜索和过滤, 一个字段同时支持search和filter</p>',10),r={href:"https://docs.wagtail.org/en/stable/topics/search/indexing.html#wagtailsearch-indexing-fields",target:"_blank",rel:"noopener noreferrer"},d=a(`<div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BlogPage</span><span class="token punctuation">(</span>Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    body <span class="token operator">=</span> RichTextField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token string">&quot;Post date&quot;</span><span class="token punctuation">)</span>

    search_fields <span class="token operator">=</span> Page<span class="token punctuation">.</span>search_fields <span class="token operator">+</span> <span class="token punctuation">[</span>
        index<span class="token punctuation">.</span>SearchField<span class="token punctuation">(</span><span class="token string">&#39;body&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        index<span class="token punctuation">.</span>FilterField<span class="token punctuation">(</span><span class="token string">&#39;date&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="editor-panels" tabindex="-1"><a class="header-anchor" href="#editor-panels" aria-hidden="true">#</a> Editor panels</h3>`,2),k={href:"https://docs.wagtail.org/en/stable/reference/pages/panels.html",target:"_blank",rel:"noopener noreferrer"},g=a(`<ul><li>content_panels - For content, such as main body text</li><li>promote_panels - metadata, such as tags, thumbnail image and SEO title</li><li>settings_panels - For settings, such as publish date</li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BlogPage</span><span class="token punctuation">(</span>Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    body <span class="token operator">=</span> RichTextField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token string">&quot;Post date&quot;</span><span class="token punctuation">)</span>

    content_panels <span class="token operator">=</span> Page<span class="token punctuation">.</span>content_panels <span class="token operator">+</span> <span class="token punctuation">[</span>
        FieldPanel<span class="token punctuation">(</span><span class="token string">&#39;date&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        FieldPanel<span class="token punctuation">(</span><span class="token string">&#39;body&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        InlinePanel<span class="token punctuation">(</span><span class="token string">&#39;related_links&#39;</span><span class="token punctuation">,</span> heading<span class="token operator">=</span><span class="token string">&quot;Related links&quot;</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&quot;Related link&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>

    promote_panels <span class="token operator">=</span> <span class="token punctuation">[</span>
        MultiFieldPanel<span class="token punctuation">(</span>Page<span class="token punctuation">.</span>promote_panels<span class="token punctuation">,</span> <span class="token string">&quot;Common page configuration&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        FieldPanel<span class="token punctuation">(</span><span class="token string">&#39;feed_image&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="parent-page-subpage-type-rules" tabindex="-1"><a class="header-anchor" href="#parent-page-subpage-type-rules" aria-hidden="true">#</a> Parent page / subpage type rules</h3><p>有两个属性控制特定页面类型用在何处,</p><ul><li>parent_page_types limits which page types this type can be created under</li><li>subpage_types limits which page types can be created under this type</li></ul><p><code>parent_page_types</code> 留空将能很好避免在页面编辑下创建特定页面</p><h3 id="page-descriptions" tabindex="-1"><a class="header-anchor" href="#page-descriptions" aria-hidden="true">#</a> Page descriptions</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>page_description <span class="token operator">=</span> <span class="token string">&quot;Use this page for converting users&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="pge-urls" tabindex="-1"><a class="header-anchor" href="#pge-urls" aria-hidden="true">#</a> Pge URLs</h3><p>最常用的方法就是在模版中<code>{% pageurl %}, {% fullpageurl %}</code>. 也可以在model中, <code>Page.get_url(request), Page.get_full_url(request)</code>, full_url包含: protocol, domain, local url</p><h2 id="template-rendering" tabindex="-1"><a class="header-anchor" href="#template-rendering" aria-hidden="true">#</a> Template rendering</h2><p>每个Model都可以指定一个html模版, 这是最简单也是最常用的方法.</p><p>模版格式: <code>&lt;app_label&gt;/&lt;model_name (snake cased)&gt;.html</code>, blog/blog_page.html, 将会自动关联</p><p>获取模版上下文: <code>{{ page.title }}</code>, 或者自定义, <code>{% for entry in blog_entries %}</code>:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BlogIndexPage</span><span class="token punctuation">(</span>Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">def</span> <span class="token function">get_context</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        context <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_context<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

        <span class="token comment"># Add extra variables and return the updated context</span>
        context<span class="token punctuation">[</span><span class="token string">&#39;blog_entries&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> BlogPage<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>child_of<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>live<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> context
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改模版, 支持动态修改:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BlogPage</span><span class="token punctuation">(</span>Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment"># 指定</span>
    template <span class="token operator">=</span> <span class="token string">&#39;other_template.html&#39;</span>

    <span class="token comment"># 动态指定</span>
    use_other_template <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_template</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_other_template<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">&#39;blog/other_blog_page.html&#39;</span>

        <span class="token keyword">return</span> <span class="token string">&#39;blog/blog_page.html&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ajax模版<code>ajax_template = &#39;other_template_fragment.html&#39;</code>, ajax请求判断(as indicated by the X-Requested-With: XMLHttpRequest HTTP header)</p><p>更多自定义</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">EventPage</span><span class="token punctuation">(</span>Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">def</span> <span class="token function">serve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">&quot;format&quot;</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">:</span>
            <span class="token keyword">if</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">[</span><span class="token string">&#39;format&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&#39;ical&#39;</span><span class="token punctuation">:</span>
                <span class="token comment"># Export to ical format</span>
                response <span class="token operator">=</span> HttpResponse<span class="token punctuation">(</span>
                    export_event<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">&#39;ical&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    content_type<span class="token operator">=</span><span class="token string">&#39;text/calendar&#39;</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
                response<span class="token punctuation">[</span><span class="token string">&#39;Content-Disposition&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;attachment; filename=&#39;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>slug <span class="token operator">+</span> <span class="token string">&#39;.ics&#39;</span>
                <span class="token keyword">return</span> response
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># Unrecognised format error</span>
                message <span class="token operator">=</span> <span class="token string">&#39;Could not export event\\n\\nUnrecognised format: &#39;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">[</span><span class="token string">&#39;format&#39;</span><span class="token punctuation">]</span>
                <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>message<span class="token punctuation">,</span> content_type<span class="token operator">=</span><span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># Display event page as usual</span>
            <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>serve<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="inline-models" tabindex="-1"><a class="header-anchor" href="#inline-models" aria-hidden="true">#</a> Inline models</h2><p>用于嵌套其他的model</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models
<span class="token keyword">from</span> modelcluster<span class="token punctuation">.</span>fields <span class="token keyword">import</span> ParentalKey
<span class="token keyword">from</span> wagtail<span class="token punctuation">.</span>models <span class="token keyword">import</span> Orderable


<span class="token keyword">class</span> <span class="token class-name">BlogPageRelatedLink</span><span class="token punctuation">(</span>Orderable<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page <span class="token operator">=</span> ParentalKey<span class="token punctuation">(</span>BlogPage<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">&#39;related_links&#39;</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    url <span class="token operator">=</span> models<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    panels <span class="token operator">=</span> <span class="token punctuation">[</span>
        FieldPanel<span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        FieldPanel<span class="token punctuation">(</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">BlogPage</span><span class="token punctuation">(</span>Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    content_panels <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        InlinePanel<span class="token punctuation">(</span><span class="token string">&#39;related_links&#39;</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&quot;Related links&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用pages" tabindex="-1"><a class="header-anchor" href="#使用pages" aria-hidden="true">#</a> 使用Pages</h2><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># Get all pages in the database</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> wagtail<span class="token punctuation">.</span>models <span class="token keyword">import</span> Page
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Page<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>Page<span class="token punctuation">:</span> Homepage<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Page<span class="token punctuation">:</span> About us<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Page<span class="token punctuation">:</span> Blog<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Page<span class="token punctuation">:</span> A Blog post<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Page<span class="token punctuation">:</span> Another Blog post<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token comment"># Get all blog entries in the database</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> BlogPage<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>BlogPage<span class="token punctuation">:</span> A Blog post<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>BlogPage<span class="token punctuation">:</span> Another Blog post<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token comment"># Get all blog entries in the database</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> BlogPage<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>BlogPage<span class="token punctuation">:</span> A Blog post<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>BlogPage<span class="token punctuation">:</span> Another Blog post<span class="token operator">&gt;</span><span class="token punctuation">]</span>

news_items <span class="token operator">=</span> NewsItemPage<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>live<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&#39;-publication_date&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,25);function v(m,b){const e=c("ExternalLinkIcon");return o(),l("div",null,[u,n("p",null,[s("更多参考"),n("a",r,[s("indexing extra fields"),t(e)])]),d,n("p",null,[s("一些属性定义了字段在页面编辑界面的排布, 每一个属性都是Panel集合, 定义了出现哪些字段以及结构, "),n("a",k,[s("Panel types"),t(e)])]),g])}const _=p(i,[["render",v],["__file","wagtail_blog.html.vue"]]);export{_ as default};
